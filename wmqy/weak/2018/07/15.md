# 周总结
> 时间 2018/07/15 - 2018/07/20  
> 好了，下面就来总结一下，这周的工作生活吧。
## 重启健身计划
好久没有运动过了，上周量了一下体重，把自己吓到了，现在居然已经156了。好吧，我一个 178 的人，还是不要那么重好了，于是乎，现在每天晚上不是跑步就是在家里 Keep，还是希望自己能够保持一个健康的体魄吧。
## elasticsearch 问题
现在从之前的框架造轮子，变成写业务代码了，从之前写 mongo 到现在写 es，本周在做 es 的时候也遇到了一些问题，这里记录下来，等之后再统一进行整理。
### es 之复制索引
因为突然，索引的名字变了，但是表结构却没有任何变化，所以，怎么样，最小成本的去干这个事呢？经过查询发现了，reindex 这个方法。
### es 之 from、size 超过 10000 条限制
在做查询的时候，因为有分页，所以用了 from、size 的解决方案，但是在数据量过大，选择 10000 过后的数据就会报错，在找解决方案的时候，可以知道，差不多就两种解决方案。
第一种，比较暴力，但是实现起来很简单，但是官方不推荐，因为性能不怎么样，就是将 index 的 max_result_window 设置的大一点，默认是 10000 的限制。
第二种，就是使用 scroll 的方式去实现，这也是官方推荐的
但是这里是因为数据量也不会多的太夸张，并且因为时间限制，选择了第一种的解决方案。
### es 之统一数据解决方案
因为需要对查询做权限处理，所以说，在数据中添加了权限字段，为数组，通过字段匹配来进行权限的校验。
### es 之聚合报错
`fielddata is disabled on text fields by default.` 
在一次聚合过程中，这样报错了，解决方案就是在 mapping 中给这个字段加上 `fielddata: true`。